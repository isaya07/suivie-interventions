import{G as w,r as d,y as E,A as a,H as v}from"./DYlgVOq5.js";const T=w("interventions",()=>{const e=d([]),o=d(null),u=d(!1),r=d({technicien_id:null,dateFrom:null,dateTo:null,status:[]}),{$api:c}=E(),h=a(()=>e.value.filter(t=>{if(r.value.technicien_id&&t.technicien_id!==r.value.technicien_id)return!1;if(r.value.dateFrom||r.value.dateTo){const n=new Date(t.date_intervention||t.date);if(r.value.dateFrom&&n<new Date(r.value.dateFrom)||r.value.dateTo&&n>new Date(r.value.dateTo))return!1}return!(r.value.status.length>0&&!r.value.status.includes(t.statut))})),p=a(()=>({enAttente:e.value.filter(t=>t.statut==="En attente").length,enCours:e.value.filter(t=>t.statut==="En cours").length,enPause:e.value.filter(t=>t.statut==="En pause").length,terminees:e.value.filter(t=>t.statut==="Terminée").length,annulees:e.value.filter(t=>t.statut==="Annulée").length,total:e.value.length})),m=async(t={})=>{u.value=!0;try{let n="/intervention.php";const i=new URLSearchParams;Object.entries(t).forEach(([l,f])=>{f&&i.append(l,f)}),i.toString()&&(n+=`?${i.toString()}`);const s=await c(n);s.records?e.value=s.records.map(l=>({...l,status:l.statut,technicien:l.technicien_nom||l.technicien})):Array.isArray(s)?e.value=s:s.data&&(e.value=s.data)}catch(n){console.error("❌ Erreur lors de la récupération des interventions:",n)}finally{u.value=!1}},I=async t=>{u.value=!0;try{const n=await c(`/intervention.php?id=${t}`);n.id&&(o.value=n)}catch(n){console.error("Erreur lors de la récupération de l'intervention:",n)}finally{u.value=!1}},g=async t=>{try{const n=await c("/intervention.php",{method:"POST",body:t});return n.success?(e.value.push(n.data),{success:!0,data:n.data}):{success:!1,message:n.message}}catch{return{success:!1,message:"Erreur lors de la création"}}},y=async t=>{try{const n=await c("/intervention.php",{method:"PUT",body:t});if(n.success){const i=e.value.findIndex(s=>s.id===t.id);return i!==-1&&(e.value[i]=n.data),o.value?.id===t.id&&(o.value=n.data),{success:!0,data:n.data}}return{success:!1,message:n.message}}catch{return{success:!1,message:"Erreur lors de la mise à jour"}}},F=t=>{r.value={...r.value,...t}},S=()=>{r.value={technicien_id:null,dateFrom:null,dateTo:null,status:[]}};return{interventions:v(e),currentIntervention:v(o),loading:v(u),filters:v(r),filteredInterventions:h,interventionsByStatus:p,fetchInterventions:m,fetchIntervention:I,createIntervention:g,updateIntervention:y,setFilters:F,clearFilters:S}}),A=()=>{const e=T();return{interventions:a(()=>e.interventions),currentIntervention:a(()=>e.currentIntervention),loading:a(()=>e.loading),filters:a(()=>e.filters),filteredInterventions:a(()=>e.filteredInterventions),interventionsByStatus:a(()=>e.interventionsByStatus),fetchInterventions:e.fetchInterventions,fetchIntervention:e.fetchIntervention,createIntervention:e.createIntervention,updateIntervention:e.updateIntervention,setFilters:e.setFilters,clearFilters:e.clearFilters}};export{A as u};
