import{_ as Q}from"./CyJ7lqwL.js";import{T as X}from"./Bo_PBiFp.js";import{y as Y,r as _,A as Z,j as ee,c as y,b as n,a as s,w as i,s as te,o as f,B as b,i as r,t as a,p as se,h as P,d as F,k as x,g as oe,D as ne}from"./DYlgVOq5.js";import{a as ie}from"./BlDxmV6q.js";import le from"./8hyyyOHM.js";import re from"./DHrzm7sw.js";import ae from"./TkXTV1AA.js";import ce from"./D5k--mLm.js";import{s as ue}from"./a_1wi9Nt.js";import{s as de}from"./HvkvFhBn.js";import me from"./2TbVYi8k.js";import{u as pe}from"./BZoA-2F6.js";import{u as ve}from"./DSFzkygU.js";import"./TrVZK8xw.js";import"./BwzGxkg-.js";import"./CBaYzeil.js";import"./DFhEUFyw.js";import"./DlAUqK2U.js";import"./Bjy1Ed27.js";import"./DyNxa_Fv.js";import"./BG2qx38A.js";import"./T8Rux-xW.js";import"./jldlmTs4.js";import"./qGzjuHAM.js";import"./BEnwzTZz.js";const fe={class:"max-w-7xl mx-auto py-6 sm:px-6 lg:px-8"},_e={class:"px-4 py-6 sm:px-0"},ye={class:"flex justify-between items-center mb-6"},be={class:"flex flex-wrap items-end gap-4"},ge={class:"flex-1 min-w-64"},xe={class:"min-w-48"},he={class:"min-w-48"},we={class:"min-w-48"},ke={key:0,class:"flex justify-center py-8"},Ce={key:1},$e={class:"text-sm font-mono text-gray-600"},Te={class:"text-sm font-medium text-gray-900"},Ve={class:"text-sm text-gray-500 max-w-xs truncate"},Ee={class:"flex items-center"},Pe={class:"text-sm text-gray-900"},Fe={class:"flex items-center"},Le={class:"text-sm text-gray-900"},Ne={class:"text-sm"},Se={class:"text-gray-900"},Ae={key:0,class:"text-gray-500"},De={class:"flex space-x-1"},Ie={class:"text-center py-8"},ct={__name:"index",setup(Re){const{$confirm:L,$toast:h}=Y(),{filteredInterventions:N,fetchInterventions:S,updateIntervention:A,loading:D}=pe(),{techniciens:I,fetchTechniciens:R}=ve(),d=_(""),c=_([]),m=_(""),p=_(""),z=[{label:"En attente",value:"En attente"},{label:"En cours",value:"En cours"},{label:"En pause",value:"En pause"},{label:"Terminée",value:"Terminée"},{label:"Annulée",value:"Annulée"}],B=[{label:"Basse",value:"basse"},{label:"Normale",value:"normale"},{label:"Haute",value:"haute"},{label:"Urgente",value:"urgente"}],w=Z(()=>{let o=N.value;if(d.value){const e=d.value.toLowerCase();o=o.filter(u=>u.titre?.toLowerCase().includes(e)||u.description?.toLowerCase().includes(e)||u.client_nom?.toLowerCase().includes(e)||u.technicien_nom?.toLowerCase().includes(e))}return c.value&&c.value.length>0&&(o=o.filter(e=>c.value.includes(e.statut))),m.value&&(o=o.filter(e=>e.priorite===m.value)),p.value&&(o=o.filter(e=>e.technicien_id==p.value)),o}),U=o=>({"En attente":"info","En cours":"warning","En pause":"secondary",Terminée:"success",Annulée:"danger",Urgente:"danger"})[o]||"secondary",O=o=>({basse:"secondary",normale:"info",haute:"warning",urgente:"danger"})[o]||"secondary",k=o=>o?new Date(o).toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric"}):"Non définie",j=o=>o.statut==="En cours",M=o=>{L.require({message:`Êtes-vous sûr de vouloir terminer l'intervention "${o.titre}" ?`,header:"Finaliser l'intervention",icon:"pi pi-check-circle",accept:async()=>{const e=await q(o.id);e.success?h.add({severity:"success",summary:"Succès",detail:"Intervention terminée avec succès",life:3e3}):h.add({severity:"error",summary:"Erreur",detail:e.message||"Erreur lors de la finalisation",life:3e3})}})},q=async o=>{try{return await A({id:o,statut:"Terminée",date_fin:new Date().toISOString().split("T")[0]})}catch(e){return console.error("Erreur lors de la finalisation:",e),{success:!1,message:"Erreur lors de la finalisation"}}};return ee(()=>{S(),R()}),(o,e)=>{const u=Q,v=te,H=me,G=de,C=ue,$=ce,W=ae,l=re,T=le,V=se,J=ie,K=ne,g=X;return f(),y("div",null,[n(u),s("main",fe,[s("div",_e,[s("div",ye,[e[6]||(e[6]=s("div",null,[s("h1",{class:"text-2xl font-bold text-gray-900 dark:text-gray-100"},"Interventions"),s("p",{class:"text-gray-600 dark:text-gray-400"},"Gérez toutes vos interventions techniques")],-1)),n(v,{label:"Nouvelle intervention",icon:"pi pi-plus",onClick:e[0]||(e[0]=t=>o.$router.push("/interventions/create")),class:"p-button-primary"})]),n($,{class:"mb-6"},{content:i(()=>[s("div",be,[s("div",ge,[e[7]||(e[7]=s("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," Recherche ",-1)),n(H,{modelValue:r(d),"onUpdate:modelValue":e[1]||(e[1]=t=>b(d)?d.value=t:null),placeholder:"Titre, description, client...",class:"w-full",icon:"pi pi-search"},null,8,["modelValue"])]),s("div",xe,[e[8]||(e[8]=s("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," Statut ",-1)),n(G,{modelValue:r(c),"onUpdate:modelValue":e[2]||(e[2]=t=>b(c)?c.value=t:null),options:z,optionLabel:"label",optionValue:"value",placeholder:"Tous les statuts",class:"w-full",display:"chip"},null,8,["modelValue"])]),s("div",he,[e[9]||(e[9]=s("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," Priorité ",-1)),n(C,{modelValue:r(m),"onUpdate:modelValue":e[3]||(e[3]=t=>b(m)?m.value=t:null),options:B,optionLabel:"label",optionValue:"value",placeholder:"Toutes priorités",class:"w-full"},null,8,["modelValue"])]),s("div",we,[e[10]||(e[10]=s("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," Technicien ",-1)),n(C,{modelValue:r(p),"onUpdate:modelValue":e[4]||(e[4]=t=>b(p)?p.value=t:null),options:r(I),optionLabel:"nom_complet",optionValue:"id",placeholder:"Tous techniciens",class:"w-full"},null,8,["modelValue","options"])])])]),_:1}),n($,null,{content:i(()=>[r(D)?(f(),y("div",ke,[n(W,{style:{width:"50px",height:"50px"},strokeWidth:"4"})])):(f(),y("div",Ce,[n(J,{value:r(w),paginator:!0,rows:10,rowsPerPageOptions:[5,10,20,50],totalRecords:r(w).length,paginatorTemplate:"RowsPerPageDropdown FirstPageLink PrevPageLink CurrentPageReport NextPageLink LastPageLink",currentPageReportTemplate:"Affichage de {first} à {last} sur {totalRecords} interventions",class:"p-datatable-sm",sortField:"date_creation",sortOrder:-1,globalFilterFields:["titre","description","client_nom","technicien_nom"]},{empty:i(()=>[s("div",Ie,[e[13]||(e[13]=s("i",{class:"pi pi-wrench text-gray-400 text-4xl mb-4"},null,-1)),e[14]||(e[14]=s("h3",{class:"text-lg font-medium text-gray-900 mb-2"},"Aucune intervention trouvée",-1)),e[15]||(e[15]=s("p",{class:"text-sm text-gray-500 mb-4"},"Aucune intervention ne correspond à vos critères.",-1)),n(v,{label:"Nouvelle intervention",icon:"pi pi-plus",onClick:e[5]||(e[5]=t=>o.$router.push("/interventions/create"))})])]),default:i(()=>[n(l,{field:"numero",header:"N°",sortable:!0,style:{width:"80px"}},{body:i(({data:t})=>[s("div",$e," #"+a(t.numero||t.id),1)]),_:1}),n(l,{field:"titre",header:"Intervention",sortable:!0},{body:i(({data:t})=>[s("div",null,[s("div",Te,a(t.titre),1),s("div",Ve,a(t.description),1)])]),_:1}),n(l,{header:"Client",sortable:!0,sortField:"client_nom"},{body:i(({data:t})=>[s("div",Ee,[n(T,{label:t.client_nom?.[0]||"C",class:"mr-2",size:"small",style:{"background-color":"#10b981",color:"white"},shape:"circle"},null,8,["label"]),s("div",Pe,a(t.client_nom||"Client non assigné"),1)])]),_:1}),n(l,{header:"Technicien",sortable:!0,sortField:"technicien_nom"},{body:i(({data:t})=>[s("div",Fe,[n(T,{label:t.technicien_nom?.[0]||"T",class:"mr-2",size:"small",style:{"background-color":"#3b82f6",color:"white"},shape:"circle"},null,8,["label"]),s("div",Le,a(t.technicien_nom||"Non assigné"),1)])]),_:1}),n(l,{header:"Statut",sortable:!0,sortField:"statut"},{body:i(({data:t})=>[n(V,{value:t.statut,severity:U(t.statut),size:"small"},null,8,["value","severity"])]),_:1}),n(l,{header:"Priorité",sortable:!0,sortField:"priorite"},{body:i(({data:t})=>[n(V,{value:t.priorite,severity:O(t.priorite),size:"small"},null,8,["value","severity"])]),_:1}),n(l,{header:"Dates",sortable:!0,sortField:"date_creation"},{body:i(({data:t})=>[s("div",Ne,[s("div",Se,[e[11]||(e[11]=s("i",{class:"pi pi-calendar mr-1"},null,-1)),F(" "+a(k(t.date_creation)),1)]),t.date_intervention?(f(),y("div",Ae,[e[12]||(e[12]=s("i",{class:"pi pi-clock mr-1"},null,-1)),F(" "+a(k(t.date_intervention)),1)])):P("",!0)])]),_:1}),n(l,{header:"Actions",sortable:!1,style:{width:"150px"}},{body:i(({data:t})=>[s("div",De,[x(n(v,{icon:"pi pi-eye",outlined:"",size:"small",onClick:E=>o.$router.push(`/interventions/${t.id}`)},null,8,["onClick"]),[[g,"Voir les détails",void 0,{top:!0}]]),x(n(v,{icon:"pi pi-pencil",outlined:"",size:"small",onClick:E=>o.$router.push(`/interventions/${t.id}/edit`)},null,8,["onClick"]),[[g,"Modifier",void 0,{top:!0}]]),j(t)?x((f(),oe(v,{key:0,icon:"pi pi-check",outlined:"",size:"small",severity:"success",onClick:E=>M(t)},null,8,["onClick"])),[[g,"Terminer",void 0,{top:!0}]]):P("",!0)])]),_:1})]),_:1},8,["value","totalRecords"])]))]),_:1})])]),n(K)])}}};export{ct as default};
