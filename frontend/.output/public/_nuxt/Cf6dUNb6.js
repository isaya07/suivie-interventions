import{G as E,r as o,y as w,A as a,H as u}from"./DYlgVOq5.js";const S=E("clients",()=>{const s=o([]),l=o(null),t=o(!1),d=o(null),{$api:n}=w(),c=async()=>{t.value=!0,d.value=null;try{const r=await n("/clients.php");r.records&&(s.value=r.records)}catch(r){d.value="Erreur lors de la récupération des clients",console.error("❌ Erreur lors de la récupération des clients:",r)}finally{t.value=!1}},f=async r=>{t.value=!0;try{const e=await n(`/clients.php?id=${r}`);return l.value=e,e}catch(e){return console.error("❌ Erreur lors de la récupération du client:",e),null}finally{t.value=!1}},p=async r=>{t.value=!0;try{const e=await n("/clients.php",{method:"POST",body:JSON.stringify(r)});return e.id?(await c(),{success:!0,data:e}):{success:!1,message:e.message}}catch(e){return console.error("❌ Erreur lors de la création du client:",e),{success:!1,message:"Erreur lors de la création"}}finally{t.value=!1}},y=async r=>{t.value=!0;try{const e=await n("/clients.php",{method:"PUT",body:JSON.stringify(r)});return e.message&&e.message.includes("succès")?(await c(),l.value&&l.value.id===r.id&&await f(r.id),{success:!0,data:e}):{success:!1,message:e.message}}catch(e){return console.error("❌ Erreur lors de la mise à jour du client:",e),{success:!1,message:"Erreur lors de la mise à jour"}}finally{t.value=!1}},C=async r=>{t.value=!0;try{const e=await n("/clients.php",{method:"DELETE",body:JSON.stringify({id:r})});return e.message&&e.message.includes("succès")?(await c(),l.value&&l.value.id===r&&(l.value=null),{success:!0,data:e}):{success:!1,message:e.message}}catch(e){return console.error("❌ Erreur lors de la suppression du client:",e),{success:!1,message:"Erreur lors de la suppression"}}finally{t.value=!1}},h=async(r,e,m=10)=>{t.value=!0;try{const i=await n(`/clients.php?location=1&lat=${r}&lng=${e}&radius=${m}`);return i.records?i.records:[]}catch(i){return console.error("❌ Erreur lors de la recherche par localisation:",i),[]}finally{t.value=!1}},g=a(()=>r=>s.value.find(e=>e.id==r)),v=a(()=>s.value.filter(r=>r.latitude&&r.longitude));return{clients:u(s),currentClient:u(l),loading:u(t),error:u(d),getClientById:g,clientsWithGPS:v,fetchClients:c,fetchClient:f,createClient:p,updateClient:y,deleteClient:C,findClientsByLocation:h}}),B=()=>{const s=S();return{clients:a(()=>s.clients),currentClient:a(()=>s.currentClient),loading:a(()=>s.loading),fetchClients:s.fetchClients,fetchClient:s.fetchClient,createClient:s.createClient,updateClient:s.updateClient,deleteClient:s.deleteClient,findClientsByLocation:s.findClientsByLocation}};export{B as u};
