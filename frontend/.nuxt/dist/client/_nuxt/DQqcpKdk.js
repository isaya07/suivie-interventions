import{_ as ne}from"./CyJ7lqwL.js";import{r as y,A as I,l as ue,c as b,o as d,a as l,h as k,b as i,i as t,t as _,s as G,f as me,y as ce,j as de,w as c,B as U,C as pe,g as j,p as ve,k as O,D as fe}from"./DYlgVOq5.js";import{s as ye,a as be}from"./BlDxmV6q.js";import{s as H}from"./a_1wi9Nt.js";import xe from"./LeZUSfni.js";import W from"./2TbVYi8k.js";import{T as ge}from"./Bo_PBiFp.js";import _e from"./DHrzm7sw.js";import we from"./8hyyyOHM.js";import he from"./TkXTV1AA.js";import ke from"./D5k--mLm.js";import{u as $e}from"./DFhEUFyw.js";import{u as Ve}from"./DSFzkygU.js";import"./TrVZK8xw.js";import"./BwzGxkg-.js";import"./CBaYzeil.js";import"./DlAUqK2U.js";import"./Bjy1Ed27.js";import"./DyNxa_Fv.js";import"./BG2qx38A.js";import"./T8Rux-xW.js";import"./jldlmTs4.js";import"./qGzjuHAM.js";import"./BEnwzTZz.js";const Ce={key:0,class:"mt-1 text-sm text-red-600"},Ue={key:0,class:"mt-1 text-sm text-red-600"},Te={key:0},Se={key:0,class:"mt-1 text-sm text-red-600"},Ae={key:0,class:"mt-1 text-sm text-red-600"},Le={class:"flex items-center"},Fe={class:"flex justify-end space-x-3 pt-4"},Re={__name:"UserForm",props:{user:{type:Object,default:null}},emits:["submit","cancel"],setup(F){const $=F,p=y(!1),n=y({}),w=I(()=>!!$.user),r=y({nom:"",email:"",password:"",role:"",telephone:"",actif:!0}),A=()=>(n.value={},r.value.nom.trim()||(n.value.nom="Le nom est requis"),r.value.email.trim()?/\S+@\S+\.\S+/.test(r.value.email)||(n.value.email="Format d'email invalide"):n.value.email="L'email est requis",!w.value&&!r.value.password?n.value.password="Le mot de passe est requis":r.value.password&&r.value.password.length<6&&(n.value.password="Le mot de passe doit contenir au moins 6 caractères"),r.value.role||(n.value.role="Le rôle est requis"),Object.keys(n.value).length===0),T=async()=>{if(A()){p.value=!0;try{const u={...r.value};w.value&&(u.id=$.user.id,u.password||delete u.password),$emit("submit",u)}catch(u){console.error("Erreur lors de la soumission:",u)}finally{p.value=!1}}};return ue(()=>$.user,u=>{u&&(r.value={nom:u.nom||"",email:u.email||"",password:"",role:u.role||"",telephone:u.telephone||"",actif:u.actif!==void 0?u.actif:!0})},{immediate:!0}),(u,o)=>{const v=W,V=xe,f=H,x=ye,g=G;return d(),b("form",{onSubmit:me(T,["prevent"]),class:"space-y-4"},[l("div",null,[o[7]||(o[7]=l("label",{for:"nom",class:"block text-sm font-medium text-gray-700"}," Nom complet * ",-1)),i(v,{id:"nom",modelValue:t(r).nom,"onUpdate:modelValue":o[0]||(o[0]=m=>t(r).nom=m),type:"text",required:"",invalid:!!t(n).nom,placeholder:"Nom complet",class:"w-full"},null,8,["modelValue","invalid"]),t(n).nom?(d(),b("p",Ce,_(t(n).nom),1)):k("",!0)]),l("div",null,[o[8]||(o[8]=l("label",{for:"email",class:"block text-sm font-medium text-gray-700"}," Email * ",-1)),i(v,{id:"email",modelValue:t(r).email,"onUpdate:modelValue":o[1]||(o[1]=m=>t(r).email=m),type:"email",required:"",invalid:!!t(n).email,placeholder:"email@exemple.com",class:"w-full"},null,8,["modelValue","invalid"]),t(n).email?(d(),b("p",Ue,_(t(n).email),1)):k("",!0)]),t(w)?k("",!0):(d(),b("div",Te,[o[9]||(o[9]=l("label",{for:"password",class:"block text-sm font-medium text-gray-700"}," Mot de passe * ",-1)),i(V,{id:"password",modelValue:t(r).password,"onUpdate:modelValue":o[2]||(o[2]=m=>t(r).password=m),required:!t(w),invalid:!!t(n).password,placeholder:"••••••••",feedback:!1,class:"w-full"},null,8,["modelValue","required","invalid"]),t(n).password?(d(),b("p",Se,_(t(n).password),1)):k("",!0)])),l("div",null,[o[10]||(o[10]=l("label",{for:"role",class:"block text-sm font-medium text-gray-700"}," Rôle * ",-1)),i(f,{id:"role",modelValue:t(r).role,"onUpdate:modelValue":o[3]||(o[3]=m=>t(r).role=m),options:[{label:"Technicien",value:"technicien"},{label:"Manager",value:"manager"},{label:"Administrateur",value:"admin"}],optionLabel:"label",optionValue:"value",placeholder:"Sélectionner un rôle",required:"",invalid:!!t(n).role,class:"w-full"},null,8,["modelValue","invalid"]),t(n).role?(d(),b("p",Ae,_(t(n).role),1)):k("",!0)]),l("div",null,[o[11]||(o[11]=l("label",{for:"telephone",class:"block text-sm font-medium text-gray-700"}," Téléphone ",-1)),i(v,{id:"telephone",modelValue:t(r).telephone,"onUpdate:modelValue":o[4]||(o[4]=m=>t(r).telephone=m),type:"tel",placeholder:"06 12 34 56 78",class:"w-full"},null,8,["modelValue"])]),l("div",Le,[i(x,{id:"actif",modelValue:t(r).actif,"onUpdate:modelValue":o[5]||(o[5]=m=>t(r).actif=m),binary:!0},null,8,["modelValue"]),o[12]||(o[12]=l("label",{for:"actif",class:"ml-2 block text-sm text-gray-900"}," Utilisateur actif ",-1))]),l("div",Fe,[i(g,{type:"button",onClick:o[6]||(o[6]=m=>u.$emit("cancel")),label:"Annuler",severity:"secondary",outlined:""}),i(g,{type:"submit",disabled:t(p),loading:t(p),label:t(p)?"Enregistrement...":t(w)?"Modifier":"Créer"},null,8,["disabled","loading","label"])])],32)}}},Pe={class:"max-w-7xl mx-auto py-6 sm:px-6 lg:px-8"},Me={class:"px-4 py-6 sm:px-0"},De={class:"flex justify-between items-center mb-6"},Ne={class:"flex flex-wrap items-end gap-4"},qe={class:"flex-1 min-w-64"},ze={class:"min-w-48"},Be={class:"min-w-48"},Ee={key:0,class:"flex justify-center py-8"},je={key:1},Oe={class:"flex items-center"},Ie={class:"text-sm font-medium text-gray-900"},Ge={class:"text-sm text-gray-500"},He={class:"flex flex-col space-y-1"},We={class:"text-sm text-gray-900"},Je={class:"text-sm text-gray-500"},Ke={class:"flex space-x-1"},_t={__name:"index",setup(F){const{$confirm:$,$toast:p}=ce(),{user:n}=$e(),{users:w,fetchUsers:r,createUser:A,updateUser:T,loading:u}=Ve(),o=y(!1),v=y(!1),V=y(null),f=y(""),x=y(""),g=y(""),m=[{label:"Administrateurs",value:"admin"},{label:"Techniciens",value:"technicien"},{label:"Managers",value:"manager"},{label:"Clients",value:"client"}],J=[{label:"Câbleurs",value:"cableur"},{label:"Terrassiers",value:"terrassier"},{label:"Autres",value:"autre"}],R=I(()=>{let a=w.value;if(f.value&&(a=a.filter(e=>e.role===f.value)),x.value&&f.value==="technicien"&&(a=a.filter(e=>e.type_technicien===x.value)),g.value){const e=g.value.toLowerCase();a=a.filter(h=>h.nom?.toLowerCase().includes(e)||h.email?.toLowerCase().includes(e))}return a}),K=a=>({admin:"Administrateur",technicien:"Technicien",manager:"Manager",client:"Client"})[a]||"Inconnu",Q=a=>({admin:"danger",technicien:"info",manager:"success",client:"secondary"})[a]||"secondary",X=a=>({cableur:"Câbleur",terrassier:"Terrassier",autre:"Autre"})[a]||"Autre",Y=a=>({cableur:"info",terrassier:"warning",autre:"secondary"})[a]||"secondary",Z=a=>a?new Date(a).toLocaleDateString("fr-FR"):"Non définie",ee=a=>{V.value=a,v.value=!0},te=async a=>{const e=a.is_active?"désactiver":"activer";$.require({message:`Êtes-vous sûr de vouloir ${e} l'utilisateur "${a.nom}" ?`,header:"Confirmation de modification",icon:"pi pi-exclamation-triangle",accept:async()=>{const h=await T({id:a.id,actif:!a.is_active});h.success?(p.add({severity:"success",summary:"Succès",detail:`Utilisateur ${e} avec succès`,life:3e3}),await r()):p.add({severity:"error",summary:"Erreur",detail:h.message,life:3e3})}})},P=async a=>{let e;o.value?e=await A(a):e=await T(a),e.success?(le(),p.add({severity:"success",summary:"Succès",detail:o.value?"Utilisateur créé avec succès":"Utilisateur modifié avec succès",life:3e3}),await r()):p.add({severity:"error",summary:"Erreur",detail:e.message,life:3e3})},le=()=>{o.value=!1,v.value=!1,V.value=null},M=()=>{f.value!=="technicien"&&(x.value="")};return de(()=>{r()}),(a,e)=>{const h=ne,S=G,se=W,D=H,N=ke,oe=he,ie=we,C=_e,L=ve,ae=be,q=Re,z=pe,re=fe,B=ge;return d(),b("div",null,[i(h),l("main",Pe,[l("div",Me,[l("div",De,[e[8]||(e[8]=l("div",null,[l("h1",{class:"text-2xl font-bold text-gray-900 dark:text-gray-100"},"Utilisateurs"),l("p",{class:"text-gray-600 dark:text-gray-400"},"Gérez les utilisateurs et techniciens")],-1)),i(S,{label:"Nouvel utilisateur",icon:"pi pi-plus",onClick:e[0]||(e[0]=s=>o.value=!0),class:"p-button-primary"})]),i(N,{class:"mb-6"},{content:c(()=>[l("div",Ne,[l("div",qe,[e[9]||(e[9]=l("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," Recherche ",-1)),i(se,{modelValue:t(g),"onUpdate:modelValue":e[1]||(e[1]=s=>U(g)?g.value=s:null),placeholder:"Nom, email...",class:"w-full",icon:"pi pi-search"},null,8,["modelValue"])]),l("div",ze,[e[10]||(e[10]=l("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," Rôle ",-1)),i(D,{modelValue:t(f),"onUpdate:modelValue":e[2]||(e[2]=s=>U(f)?f.value=s:null),options:m,optionLabel:"label",optionValue:"value",placeholder:"Tous les rôles",class:"w-full",onChange:M},null,8,["modelValue"])]),l("div",Be,[e[11]||(e[11]=l("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," Type technicien ",-1)),i(D,{modelValue:t(x),"onUpdate:modelValue":e[3]||(e[3]=s=>U(x)?x.value=s:null),options:J,optionLabel:"label",optionValue:"value",placeholder:"Tous les types",disabled:t(f)!=="technicien",class:"w-full",onChange:M},null,8,["modelValue","disabled"])])])]),_:1}),i(N,null,{content:c(()=>[t(u)?(d(),b("div",Ee,[i(oe,{style:{width:"50px",height:"50px"},strokeWidth:"4"})])):(d(),b("div",je,[i(ae,{value:t(R),paginator:!0,rows:10,rowsPerPageOptions:[5,10,20,50],totalRecords:t(R).length,paginatorTemplate:"RowsPerPageDropdown FirstPageLink PrevPageLink CurrentPageReport NextPageLink LastPageLink",currentPageReportTemplate:"Affichage de {first} à {last} sur {totalRecords} utilisateurs",class:"p-datatable-sm",sortField:"nom",sortOrder:1,globalFilterFields:["nom","email"]},{empty:c(()=>e[12]||(e[12]=[l("div",{class:"text-center py-8"},[l("i",{class:"pi pi-users text-gray-400 text-4xl mb-4"}),l("h3",{class:"text-lg font-medium text-gray-900 mb-2"},"Aucun utilisateur trouvé"),l("p",{class:"text-sm text-gray-500"},"Aucun utilisateur ne correspond à vos critères.")],-1)])),default:c(()=>[i(C,{field:"nom",header:"Utilisateur",sortable:!0},{body:c(({data:s})=>[l("div",Oe,[i(ie,{label:s.nom?.[0]||"U",class:"mr-3",style:{"background-color":"#3b82f6",color:"white"},shape:"circle"},null,8,["label"]),l("div",null,[l("div",Ie,_(s.nom),1),l("div",Ge,_(s.email),1)])])]),_:1}),i(C,{header:"Rôle",sortable:!0,sortField:"role"},{body:c(({data:s})=>[l("div",He,[i(L,{value:K(s.role),severity:Q(s.role),size:"small"},null,8,["value","severity"]),s.role==="technicien"&&s.type_technicien?(d(),j(L,{key:0,value:X(s.type_technicien),severity:Y(s.type_technicien),size:"small"},null,8,["value","severity"])):k("",!0)])]),_:1}),i(C,{header:"Contact",sortable:!1},{body:c(({data:s})=>[l("div",null,[l("div",We,_(s.telephone||"-"),1),l("div",Je,_(Z(s.date_creation)),1)])]),_:1}),i(C,{header:"Statut",sortable:!0,sortField:"is_active"},{body:c(({data:s})=>[i(L,{value:s.is_active?"Actif":"Inactif",severity:s.is_active?"success":"danger",size:"small"},null,8,["value","severity"])]),_:1}),i(C,{header:"Actions",sortable:!1,style:{width:"150px"}},{body:c(({data:s})=>[l("div",Ke,[O(i(S,{icon:"pi pi-eye",outlined:"",size:"small",onClick:E=>a.$router.push(`/users/${s.id}`)},null,8,["onClick"]),[[B,"Voir les détails",void 0,{top:!0}]]),O(i(S,{icon:"pi pi-pencil",outlined:"",size:"small",onClick:E=>ee(s)},null,8,["onClick"]),[[B,"Modifier",void 0,{top:!0}]]),s.id!==t(n)?.id?(d(),j(S,{key:0,icon:s.is_active?"pi pi-times":"pi pi-check",outlined:"",size:"small",severity:s.is_active?"danger":"success",onClick:E=>te(s),"v-tooltip":s.is_active?"Désactiver":"Activer"},null,8,["icon","severity","onClick","v-tooltip"])):k("",!0)])]),_:1})]),_:1},8,["value","totalRecords"])]))]),_:1})])]),i(z,{visible:t(o),"onUpdate:visible":e[5]||(e[5]=s=>U(o)?o.value=s:null),modal:!0,header:"Nouvel utilisateur",style:{width:"50rem"},maximizable:!0,closable:!0},{default:c(()=>[i(q,{user:null,onSubmit:P,onCancel:e[4]||(e[4]=s=>o.value=!1)})]),_:1},8,["visible"]),i(z,{visible:t(v),"onUpdate:visible":e[7]||(e[7]=s=>U(v)?v.value=s:null),modal:!0,header:"Modifier l'utilisateur",style:{width:"50rem"},maximizable:!0,closable:!0},{default:c(()=>[i(q,{user:t(V),onSubmit:P,onCancel:e[6]||(e[6]=s=>v.value=!1)},null,8,["user"])]),_:1},8,["visible"]),i(re)])}}};export{_t as default};
