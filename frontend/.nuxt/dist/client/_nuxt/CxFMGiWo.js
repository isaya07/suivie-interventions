import{r as m,A as T,l as q,j as B,c as d,o as u,a as n,b as r,h as p,i as t,t as v,s as D,f as I}from"./DYlgVOq5.js";import S from"./gtg-t9u8.js";import{s as j}from"./a_1wi9Nt.js";import E from"./B20p3wMs.js";import N from"./2TbVYi8k.js";import{u as C}from"./DSFzkygU.js";import{u as F}from"./BZoA-2F6.js";const M={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},A={class:"md:col-span-2"},O={key:0,class:"mt-1 text-sm text-red-600"},P={class:"md:col-span-2"},H={key:0,class:"mt-1 text-sm text-red-600"},z={key:0,class:"mt-1 text-sm text-red-600"},G={class:"flex justify-end space-x-3"},Z={__name:"InterventionForm",props:{intervention:{type:Object,default:null}},emits:["submit","cancel"],setup(V){const c=V,{techniciens:_,fetchTechniciens:g}=C(),{createIntervention:k,updateIntervention:h}=F(),a=m(!1),o=m({}),f=T(()=>!!c.intervention),i=m({titre:"",description:"",technicien_id:"",priorite:"normale",date_prevue:"",lieu:""}),w=()=>(o.value={},i.value.titre.trim()||(o.value.titre="Le titre est requis"),i.value.description.trim()||(o.value.description="La description est requise"),i.value.technicien_id||(o.value.technicien_id="Le technicien est requis"),Object.keys(o.value).length===0),U=async()=>{if(w()){a.value=!0;try{let l;f.value?l=await h({...i.value,id:c.intervention.id}):l=await k(i.value),l.success?$emit("submit",l.data):l.errors&&(o.value=l.errors)}catch(l){console.error("Erreur lors de la soumission:",l)}finally{a.value=!1}}};return q(()=>c.intervention,l=>{l&&(i.value={titre:l.titre||"",description:l.description||"",technicien_id:l.technicien_id||"",priorite:l.priorite||"normale",date_prevue:l.date_prevue||"",lieu:l.lieu||""})},{immediate:!0}),B(()=>{g()}),(l,e)=>{const b=N,L=E,x=j,$=S,y=D;return u(),d("form",{onSubmit:I(U,["prevent"]),class:"space-y-6"},[n("div",M,[n("div",A,[e[7]||(e[7]=n("label",{for:"titre",class:"block text-sm font-medium text-gray-700"}," Titre * ",-1)),r(b,{id:"titre",modelValue:t(i).titre,"onUpdate:modelValue":e[0]||(e[0]=s=>t(i).titre=s),type:"text",required:"",invalid:!!t(o).titre,placeholder:"Titre de l'intervention",class:"w-full"},null,8,["modelValue","invalid"]),t(o).titre?(u(),d("p",O,v(t(o).titre),1)):p("",!0)]),n("div",P,[e[8]||(e[8]=n("label",{for:"description",class:"block text-sm font-medium text-gray-700"}," Description * ",-1)),r(L,{id:"description",modelValue:t(i).description,"onUpdate:modelValue":e[1]||(e[1]=s=>t(i).description=s),required:"",rows:"4",invalid:!!t(o).description,placeholder:"Description détaillée de l'intervention",class:"w-full"},null,8,["modelValue","invalid"]),t(o).description?(u(),d("p",H,v(t(o).description),1)):p("",!0)]),n("div",null,[e[9]||(e[9]=n("label",{for:"technicien_id",class:"block text-sm font-medium text-gray-700"}," Technicien assigné * ",-1)),r(x,{id:"technicien_id",modelValue:t(i).technicien_id,"onUpdate:modelValue":e[2]||(e[2]=s=>t(i).technicien_id=s),options:t(_),optionLabel:"nom",optionValue:"id",placeholder:"Sélectionner un technicien",invalid:!!t(o).technicien_id,class:"w-full"},null,8,["modelValue","options","invalid"]),t(o).technicien_id?(u(),d("p",z,v(t(o).technicien_id),1)):p("",!0)]),n("div",null,[e[10]||(e[10]=n("label",{for:"priorite",class:"block text-sm font-medium text-gray-700"}," Priorité ",-1)),r(x,{id:"priorite",modelValue:t(i).priorite,"onUpdate:modelValue":e[3]||(e[3]=s=>t(i).priorite=s),options:[{label:"Basse",value:"basse"},{label:"Normale",value:"normale"},{label:"Haute",value:"haute"},{label:"Urgente",value:"urgente"}],optionLabel:"label",optionValue:"value",class:"w-full"},null,8,["modelValue"])]),n("div",null,[e[11]||(e[11]=n("label",{for:"date_prevue",class:"block text-sm font-medium text-gray-700"}," Date prévue ",-1)),r($,{id:"date_prevue",modelValue:t(i).date_prevue,"onUpdate:modelValue":e[4]||(e[4]=s=>t(i).date_prevue=s),dateFormat:"dd/mm/yy",class:"w-full"},null,8,["modelValue"])]),n("div",null,[e[12]||(e[12]=n("label",{for:"lieu",class:"block text-sm font-medium text-gray-700"}," Lieu ",-1)),r(b,{id:"lieu",modelValue:t(i).lieu,"onUpdate:modelValue":e[5]||(e[5]=s=>t(i).lieu=s),type:"text",placeholder:"Lieu de l'intervention",class:"w-full"},null,8,["modelValue"])])]),n("div",G,[r(y,{type:"button",onClick:e[6]||(e[6]=s=>l.$emit("cancel")),label:"Annuler",severity:"secondary",outlined:""}),r(y,{type:"submit",disabled:t(a),loading:t(a),label:t(a)?"Enregistrement...":t(f)?"Modifier":"Créer"},null,8,["disabled","loading","label"])])],32)}}};export{Z as _};
