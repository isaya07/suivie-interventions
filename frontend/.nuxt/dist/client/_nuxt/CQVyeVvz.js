import{_ as J}from"./CyJ7lqwL.js";import{_ as K}from"./BwcFvxo7.js";import{T as Q}from"./Bo_PBiFp.js";import{y as X,r as _,A as Y,j as Z,c as r,b as o,a as s,w as i,B as y,i as c,s as ee,C as te,o as n,t as u,h as C,d as se,k as w,g as h,D as le}from"./DYlgVOq5.js";import{a as oe}from"./BlDxmV6q.js";import ie from"./DHrzm7sw.js";import ne from"./8hyyyOHM.js";import ae from"./TkXTV1AA.js";import re from"./D5k--mLm.js";import{s as ce}from"./a_1wi9Nt.js";import ue from"./2TbVYi8k.js";import{u as de}from"./DFhEUFyw.js";import{u as me}from"./Cf6dUNb6.js";import"./TrVZK8xw.js";import"./BwzGxkg-.js";import"./CBaYzeil.js";import"./DlAUqK2U.js";import"./DyNxa_Fv.js";import"./BG2qx38A.js";import"./B20p3wMs.js";import"./Bjy1Ed27.js";import"./T8Rux-xW.js";import"./jldlmTs4.js";import"./qGzjuHAM.js";import"./BEnwzTZz.js";const pe={class:"max-w-7xl mx-auto py-6 sm:px-6 lg:px-8"},ve={class:"px-4 py-6 sm:px-0"},fe={class:"flex justify-between items-center mb-6"},_e={class:"flex flex-wrap items-end gap-4"},xe={class:"flex-1 min-w-64"},ye={class:"min-w-48"},ge={key:0,class:"flex justify-center py-8"},be={key:1},Ce={class:"flex items-center"},we={class:"text-sm font-medium text-gray-900"},he={class:"text-sm text-gray-500"},ke={class:"text-sm text-gray-900"},$e={class:"text-sm text-gray-500"},Pe={class:"text-sm text-gray-900 max-w-xs"},Se={key:0},Ae={key:1,class:"text-gray-500 truncate"},Ve={key:2,class:"text-gray-400"},Le={key:0,class:"flex items-center text-green-600"},Fe={class:"text-xs"},Ne={key:1,class:"text-gray-400 text-xs"},Te={class:"flex space-x-1"},nt={__name:"index",setup(Me){const{$confirm:L}=X();de();const{clients:F,fetchClients:N,createClient:T,updateClient:M,deleteClient:R,loading:z}=me(),a=_(!1),m=_(!1),g=_(null),p=_(""),v=_("all"),B=[{label:"Tous les clients",value:"all"},{label:"Avec coordonnées GPS",value:"with-gps"},{label:"Sans coordonnées GPS",value:"without-gps"}],k=Y(()=>{let l=F.value;if(v.value==="with-gps"?l=l.filter(e=>e.latitude&&e.longitude):v.value==="without-gps"&&(l=l.filter(e=>!e.latitude||!e.longitude)),p.value){const e=p.value.toLowerCase();l=l.filter(d=>d.nom?.toLowerCase().includes(e)||d.email?.toLowerCase().includes(e)||d.ville?.toLowerCase().includes(e)||d.contact_principal?.toLowerCase().includes(e)||d.telephone?.includes(e))}return l}),D=(l,e)=>!l||!e?"":`${parseFloat(l).toFixed(4)}, ${parseFloat(e).toFixed(4)}`,G=l=>{g.value=l,m.value=!0},E=async l=>{L.require({message:`Êtes-vous sûr de vouloir supprimer le client "${l.nom}" ?`,header:"Confirmation de suppression",icon:"pi pi-exclamation-triangle",accept:async()=>{const e=await R(l.id);e.success?$toast.add({severity:"success",summary:"Succès",detail:"Client supprimé avec succès",life:3e3}):$toast.add({severity:"error",summary:"Erreur",detail:e.message,life:3e3})}})},$=async l=>{let e;a.value?e=await T(l):e=await M(l),e.success?(U(),$toast.add({severity:"success",summary:"Succès",detail:a.value?"Client créé avec succès":"Client modifié avec succès",life:3e3})):$toast.add({severity:"error",summary:"Erreur",detail:e.message,life:3e3})},U=()=>{a.value=!1,m.value=!1,g.value=null};return Z(()=>{N()}),(l,e)=>{const d=J,x=ee,j=ue,O=ce,P=re,q=ae,H=ne,f=ie,I=oe,S=K,A=te,W=le,b=Q;return n(),r("div",null,[o(d),s("main",pe,[s("div",ve,[s("div",fe,[e[7]||(e[7]=s("div",null,[s("h1",{class:"text-2xl font-bold text-gray-900 dark:text-gray-100"},"Clients"),s("p",{class:"text-gray-600 dark:text-gray-400"},"Gérez vos clients et leurs informations")],-1)),o(x,{label:"Nouveau client",icon:"pi pi-plus",onClick:e[0]||(e[0]=t=>a.value=!0),class:"p-button-primary"})]),o(P,{class:"mb-6"},{content:i(()=>[s("div",_e,[s("div",xe,[e[8]||(e[8]=s("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," Recherche ",-1)),o(j,{modelValue:c(p),"onUpdate:modelValue":e[1]||(e[1]=t=>y(p)?p.value=t:null),placeholder:"Nom, email, ville...",class:"w-full",icon:"pi pi-search"},null,8,["modelValue"])]),s("div",ye,[e[9]||(e[9]=s("label",{class:"block text-sm font-medium text-gray-700 mb-2"}," Affichage ",-1)),o(O,{modelValue:c(v),"onUpdate:modelValue":e[2]||(e[2]=t=>y(v)?v.value=t:null),options:B,optionLabel:"label",optionValue:"value",class:"w-full"},null,8,["modelValue"])])])]),_:1}),o(P,null,{content:i(()=>[c(z)?(n(),r("div",ge,[o(q,{style:{width:"50px",height:"50px"},strokeWidth:"4"})])):(n(),r("div",be,[o(I,{value:c(k),paginator:!0,rows:10,rowsPerPageOptions:[5,10,20,50],totalRecords:c(k).length,paginatorTemplate:"RowsPerPageDropdown FirstPageLink PrevPageLink CurrentPageReport NextPageLink LastPageLink",currentPageReportTemplate:"Affichage de {first} à {last} sur {totalRecords} clients",class:"p-datatable-sm",sortField:"nom",sortOrder:1,globalFilterFields:["nom","email","ville","contact_principal","telephone"]},{empty:i(()=>e[15]||(e[15]=[s("div",{class:"text-center py-8"},[s("i",{class:"pi pi-users text-gray-400 text-4xl mb-4"}),s("h3",{class:"text-lg font-medium text-gray-900 mb-2"},"Aucun client trouvé"),s("p",{class:"text-sm text-gray-500"},"Aucun client ne correspond à vos critères.")],-1)])),default:i(()=>[o(f,{field:"nom",header:"Client",sortable:!0},{body:i(({data:t})=>[s("div",Ce,[o(H,{label:t.nom?.[0]||"C",class:"mr-3",style:{"background-color":"#3b82f6",color:"white"},shape:"circle"},null,8,["label"]),s("div",null,[s("div",we,u(t.nom),1),s("div",he,u(t.contact_principal||"Pas de contact"),1)])])]),_:1}),o(f,{header:"Contact",sortable:!1},{body:i(({data:t})=>[s("div",null,[s("div",ke,u(t.email||"-"),1),s("div",$e,u(t.telephone||"-"),1)])]),_:1}),o(f,{header:"Adresse",sortable:!1},{body:i(({data:t})=>[s("div",Pe,[t.ville||t.code_postal?(n(),r("div",Se,u(t.ville)+" "+u(t.code_postal),1)):C("",!0),t.adresse?(n(),r("div",Ae,u(t.adresse),1)):C("",!0),!t.ville&&!t.code_postal&&!t.adresse?(n(),r("div",Ve," Pas d'adresse ")):C("",!0)])]),_:1}),o(f,{header:"GPS",sortable:!1},{body:i(({data:t})=>[t.latitude&&t.longitude?(n(),r("div",Le,[e[10]||(e[10]=s("i",{class:"pi pi-map-marker mr-1"},null,-1)),s("span",Fe,u(D(t.latitude,t.longitude)),1)])):(n(),r("div",Ne,e[11]||(e[11]=[s("i",{class:"pi pi-times"},null,-1),se(" Pas de GPS ",-1)])))]),_:1}),o(f,{header:"Actions",sortable:!1,style:{width:"150px"}},{body:i(({data:t})=>[s("div",Te,[w((n(),h(x,{outlined:"",size:"small",onClick:V=>l.$router.push(`/clients/${t.id}`)},{default:i(()=>e[12]||(e[12]=[s("i",{class:"pi pi-eye"},null,-1)])),_:2,__:[12]},1032,["onClick"])),[[b,"Voir les détails",void 0,{top:!0}]]),w((n(),h(x,{outlined:"",size:"small",onClick:V=>G(t)},{default:i(()=>e[13]||(e[13]=[s("i",{class:"pi pi-pencil"},null,-1)])),_:2,__:[13]},1032,["onClick"])),[[b,"Modifier",void 0,{top:!0}]]),w((n(),h(x,{outlined:"",size:"small",severity:"danger",onClick:V=>E(t)},{default:i(()=>e[14]||(e[14]=[s("i",{class:"pi pi-trash"},null,-1)])),_:2,__:[14]},1032,["onClick"])),[[b,"Supprimer",void 0,{top:!0}]])])]),_:1})]),_:1},8,["value","totalRecords"])]))]),_:1})])]),o(A,{visible:c(a),"onUpdate:visible":e[4]||(e[4]=t=>y(a)?a.value=t:null),modal:!0,header:"Nouveau client",style:{width:"50rem"},maximizable:!0,closable:!0},{default:i(()=>[o(S,{client:null,onSubmit:$,onCancel:e[3]||(e[3]=t=>a.value=!1)})]),_:1},8,["visible"]),o(A,{visible:c(m),"onUpdate:visible":e[6]||(e[6]=t=>y(m)?m.value=t:null),modal:!0,header:"Modifier le client",style:{width:"50rem"},maximizable:!0,closable:!0},{default:i(()=>[o(S,{client:c(g),onSubmit:$,onCancel:e[5]||(e[5]=t=>m.value=!1)},null,8,["client"])]),_:1},8,["visible"]),o(W)])}}};export{nt as default};
